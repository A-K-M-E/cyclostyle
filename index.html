<!doctype html>
<html class="h-100">
<head>

<!-- Must -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<meta name="description" content="">
<meta name="keywords" content="">
<link rel="manifest" href="js/manifest.json">
<title>Ciclostyle intergalattico</title>

<!-- Android  -->
<meta name="theme-color" content="white">
<meta name="mobile-web-app-capable" content="yes">

<!-- iOS -->
<meta name="apple-mobile-web-app-title" content="Ciclostyle intergalattico">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<!-- Windows  -->
<meta name="msapplication-navbutton-color" content="white">
<meta name="msapplication-TileColor" content="white">
<meta name="msapplication-TileImage" content="icons/ms-icon-144x144.png">
<meta name="msapplication-config" content="icons/browserconfig.xml">

<!-- Pinned Sites  -->
<meta name="application-name" content="Ciclostyle intergalattico">
<meta name="msapplication-tooltip" content="Ciclostyle intergalattico">
<meta name="msapplication-starturl" content="/">

<!-- Tap highlighting  -->
<meta name="msapplication-tap-highlight" content="no">

<!-- UC Mobile Browser  -->
<meta name="full-screen" content="yes">
<meta name="browsermode" content="application">

<!-- Disable night mode for this page  -->
<meta name="nightmode" content="enable/disable">

<!-- Fitscreen  -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Layout mode -->
<meta name="layoutmode" content="fitscreen/standard">

<!-- imagemode - show image even in text only mode  -->
<meta name="imagemode" content="force">

<!-- Orientation  -->
<meta name="screen-orientation" content="portrait">

<!-- Main Link Tags  -->
<link href="icons/favicon-16x16.png" rel="icon" type="image/png" sizes="16x16">
<link href="icons/favicon-32x32.png" rel="icon" type="image/png" sizes="32x32">
<link href="icons/favicon-96x96.png" rel="icon" type="image/png" sizes="96x96">

<!-- iOS  -->
<link href="icons/apple-icon.png" rel="apple-touch-icon">
<link href="icons/apple-icon-76x76.png" rel="apple-touch-icon" sizes="76x76">
<link href="icons/apple-icon-120x120.png" rel="apple-touch-icon" sizes="120x120">
<link href="icons/apple-icon-152x152.png" rel="apple-touch-icon" sizes="152x152">
<link href="icons/apple-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" >


<!-- Startup Image  -->
<!--<link href="touch-icon-start-up-320x480.png" rel="apple-touch-startup-image">-->

<!-- Pinned Tab  -->
<!--<link href="path/to/icon.svg" rel="mask-icon" size="any" color="white">-->

<!-- Android  -->
<link href="icons/android-icon-192x192.png" rel="icon" sizes="192x192">
<!--<link href="icon-128x128.png" rel="icon" sizes="128x128">-->

<!-- Others -->
<link href="icons/favicon.ico" rel="shortcut icon" type="image/x-icon">

<!-- UC Browser  -->
<link href="icons/apple-icon-57x57.png" rel="apple-touch-icon-precomposed" sizes="57x57">
<link href="icons/apple-icon-72x72.png" rel="apple-touch-icon" sizes="72x72">


<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/cropper.min.css">

<!-- interfaccia http ipfs-->
<!-- <script src="https://ipfs.io/ipfs/QmRaSYnTBnKyYw83dDFvq8Rxwt4Qn5LRkCRdLJCAVxNgau"></script>-->
<!-- jQuery-slim-minified-->
<script src="js/jquery-3.4.1.slim.min.js" ></script>



<!-- <script> if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./js/sw.js') .then(function(registration) { console.log('Registration successful, scope is:', registration.scope); }) .catch(function(error) { console.log('Service worker registration failed, error:', error); }); } </script>

<script>
  // codice preso da qui:
  // https://github.com/ipfs/js-ipfs/tree/master/examples/browser-script-tag
  // al posto di usare il cdn ho usato ipfs per il file javascript di interfacca a ipfs
  document.addEventListener('DOMContentLoaded', async () => {
    const node = await Ipfs.create({ repo: 'ipfs-' + Math.random() })
    window.node = node
    if(node.isOnline()){ $("#main").show(); $("#testo").jeditor();}
    console.log(node)

      // You can write more code here to use it. Use methods like
      // node.add, node.get. See the API docs here:
      // https://github.com/ipfs/js-ipfs/tree/master/packages/interface-ipfs-core
  });

  function upload () {
    var file = document.getElementById("cover").files[0];
    if( typeof file != "undefined")
    {
      // oggeto di input per ipfs add
      fileToUpload =[{
          content : file
      }]
      sendToIpfs(fileToUpload);
    }
      // c'Ã¨ bisogno di un messaggio di alert in caso di mancata selezione del file
  }

  async function sendToIpfs(files)
  {
    const cid  = await node.add(files);
    console.log('successfully stored', cid);
    var cover = "https://gateway.pinata.cloud/ipfs/"+cid.path;
    var testo = $("#testo").val();
    var cs = `<!DOCTYPE html>
      <html>
        <head></head>
        <body>
          <div style="margin: 0 auto">
            <img style="margin:0 auto;" src="${cover}"><br>
            <p>${testo}</p>
          </div>
        </body>
    </html>`;
    const cs_ipfs = await node.add(cs);
    $("#fyler").html(`<a href='https://ipfs.io/ipfs/${cs_ipfs.path}' target='_blank'>vedi il risultato</a>`);
  }


</script> -->
<script src="js/cropper.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    // vars
    let result = document.querySelector('.result'),
    img_result = document.querySelector('.img-result'),
    img_w = document.querySelector('.img-w'),
    img_h = document.querySelector('.img-h'),
    save = document.querySelector('.box-cropper'),
    close = document.querySelector('.close'),
    cropped = document.querySelector('.cropped'),
    upload = document.querySelector('#cover'),
    cropper = '';

    // on change show image with crop options
    upload.addEventListener('change', (e) => {
      if (e.target.files.length) {
    		// start file reader
        const reader = new FileReader();
        reader.onload = (e)=> {
          if(e.target.result){
    				// create new image
    				let img = document.createElement('img');
    				img.id = 'image';
    				img.src = e.target.result
    				// clean result before
    				result.innerHTML = '';
    				// append new image
            result.appendChild(img);
    				// show save btn and options
            save.style.height = window.innerHeight;
            result.style.top = save.scrollTop;
    				save.classList.remove('hide');

    				// init cropper
    				cropper = new Cropper(img, {
              aspectRatio: 16 / 6
            });
          }
        };
        reader.readAsDataURL(e.target.files[0]);
      }
    });

    // save on click
    save.addEventListener('click',(e)=>{
      e.preventDefault();
      // get result to data uri
      let imgSrc = cropper.getCroppedCanvas({
    		width: img_w.value //
    	}).toDataURL();
      // remove hide class of img
      cropped.classList.remove('hide');
    	img_result.classList.remove('hide');
      close.classList.remove('hide');
    	// show image cropped
      cropped.src = imgSrc;
    });
    close.addEventListener('click',(e)=>{
      e.preventDefault();
      save.classList.add('hide');
      });
  });
</script>
</head>
<body class="d-flex flex-column h-100">

    <main class="flex-shrink-0">
      <header>
      <nav class="navbar">
          <a class="navbar-brand" href="#">
            <img src="images/logo.svg" alt="" width="250" height="85">
          </a>
      </nav>
    </header>
      <div class="container pt-3">

      <h1 class="mb-3">Create your flyer</h1>

      <!--cropper-->
      <div class="box-cropper hide container-fluid">
		   <div class="result mb-3" id="result"></div>
       <div class="options hide">
         <input type="number" class="img-w" value="1024" min="768" max="1024" />
       </div>
       <!-- save btn -->
       <button class="btn save btn-primary ">Crop</button>
       <button class="btn close hide btn-primary ">Done</button>
    	</div>
      <div class="panel" id="panel-content">
        <h2>Content</h2>
          <div class="mb-3">
            <label for="exampleFormControlInput1" class="form-label">Title</label>
            <input type="text" class="form-control">
          </div>
          <div class="mb-3">
            <label for="exampleFormControlInput1" class="form-label">Testo</label>
            <textarea class="form-control" id="testo" rows="3"></textarea>
          </div>
          <div class="mb-3">
            <label for="exampleFormControlTextarea1" class="form-label">Who?</label>
            <textarea class="form-control" id="chi" rows="3"></textarea>
          </div>
          <div class="mb-3">
            <label for="exampleFormControlTextarea1" class="form-label">Where?</label>
            <textarea class="form-control" id="dove" rows="3"></textarea>
          </div>
      </div>
      <div class="hide panel" id="panel-date">
        <h2>Date</h2>
          <div class="mb-3">
            <label for="exampleFormControlInput1" class="form-label">When?</label>
            <input type="date" class="form-control">
          </div>

          <div class="mb-3">
            <label for="exampleFormControlInput1" class="form-label">Hours</label>
            <input type="time" class="form-control">
          </div>
      </div>
      <div class="hide panel" id="panel-template">
        <h2>Template</h2>
               <div class="mb-3">
            <label for="exampleColorInput" class="form-label">Main color</label>
            <input type="color" class="form-control form-control-color" id="exampleColorInput" value="#0397BB" title="Choose your color">
            </div>
           <div class="input-group mb-3">
              <label class="input-group-text" for="inputGroupSelect01">Template</label>
              <select class="form-select" id="inputGroupSelect01">
                <option selected value="1">Default</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
              </select>
            </div>
          <div class="mb-5 pb-2 page">
              <label for="formFile" class="form-label">Upload, Crop and save cover </label>
              <small>(1024px min-width)</small>
              <!-- input file -->
              <input class="form-control" type="file" id="cover">



            <!-- result of crop -->
          	<div class="box-2 img-result hide mb-3 mt-3">
              <label for="exampleFormControlTextarea1" class="form-label">Preview cover</label>
          		<img class="cropped" src="" alt="">
          	</div>
            </div>
      </div>
      </div>
      <div id="flyer" class="hide"></div>
  </main>
      <footer class="footer mt-auto py-3 bg-light fixed-bottom">
        <div class="container">
          <div class="menu-create text-center">
            <ul class="nav nav-pills">
              <li class="nav-item">
                <a class="nav-link active first" href="#" data-target="panel-content">Content</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" data-target="panel-date">Date</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" data-target="panel-template">Template</a>
              </li>
            </ul>
          <button  type="submit" class="btn btn-outline-danger ms-2" id="preview" >Preview</button>
        </div>
         <div class="text-end finalize hide">
           <button type="submit" class="btn btn-outline-danger ms-2" id="back">Edit</button>
            <button onclick="upload()" type="submit" class="btn btn-primary ">Upload On IPFS</button>
          </div>
        </div>
      </footer>

    <!-- jQuery-bootstrap-->
    <script src="js/bootstrap.bundle.min.js"></script>
    <script>
    $(function(){
        $('.nav-link').click(function(){
            var target = $(this).data('target');
            $('.panel').hide();
            $('.active').removeClass( "active" );
            $(this).addClass( "active" );
            $('#'+target).show();
        });
          $('#preview').click(function(){
            $('.panel').hide();
            $('.menu-create').hide();
            $('.text-end').show();
            $('#flyer').show();
            $('.active').removeClass( "active" );
          });
          $('#back').click(function(){
            $('#panel-content').show();
            $('.menu-create').show();
            $('.text-end').hide();
            $('.first').addClass( "active" );
            $('#flyer').hide();
          });
    });
    </script>
</body>
</html>
