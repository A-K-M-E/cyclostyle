var mlCodes = [{
        code: "en",
        name: "English",
    },

    {
        code: "it",
        name: "Italiano",
    },

    {
        code: "es",
        name: "Español",
    },

    {
        code: "fr",
        name: "Français",
    }

];

var MLstrings = [{
        English: "new flyer",
        Italiano: "nuovo volantino",
        Español: "nuevo volante",
        Français: "nouveau dépliant",
    },
    {
        English: "drafts",
        Italiano: "bozze",
        Español: "borradores",
        Français: "brouillons",
    },
    {
        English: "bookmarks",
        Italiano: "segnalibri",
        Español: "marcadores",
        Français: "signets",
    },
    {
        English: "settings",
        Italiano: "impostazioni",
        Español: "ajustes",
        Français: "réglages",
    },
    {
        English: "create a flyer",
        Italiano: "crea un volantino",
        Español: "crea un volante",
        Français: "créer un dépliant",
    },
    {
        English: "Crop",
        Italiano: "Ritaglia",
        Español: "Corta",
        Français: "Coupe",
    },
    {
        English: "Done",
        Italiano: "Fatto",
        Español: "Hecho",
        Français: "Terminé",
    },
    {
        English: "Template",
        Italiano: "Tema",
        Español: "Plantilla",
        Français: "Modèle",
    },
    {
        English: "Content",
        Italiano: "contenuto",
        Español: "Contenido",
        Français: "Contenu",
    },
    {
        English: "Details",
        Italiano: "Dettagli",
        Español: "Detalles",
        Français: "Détails",
    },
    {
        English: "Preview",
        Italiano: "Anteprima",
        Español: "Vista previa",
        Français: "Prévisualisation",
    },
    {
        English: "Edit",
        Italiano: "Modifica",
        Español: "Revisar",
        Français: "Modifier",
    },
    {
        English: "Save Draft",
        Italiano: "Salva bozza",
        Español: "Guarda el borrador",
        Français: "Sauver le brouillon",
    },
    {
        English: "Print On IPFS",
        Italiano: "Stampa su IPFS",
        Español: "Imprimir sobre IPFS",
        Français: "Imprimer sur IPFS",
    },
    {
        English: "Next >",
        Italiano: "Successivo >",
        Español: "Pròximo >",
        Français: "Prochain >",
    },
    {
        English: "< Previous",
        Italiano: "< Precedente",
        Español: "< Previo",
        Français: "< Dernier",
    },
    {
        English: "Main color",
        Italiano: "Colore principale",
        Español: "Color principal",
        Français: "Couleur principale",
    },
    {
        English: "Upload, Crop and save cover",
        Italiano: "Carica, ritaglia e salva l'immagine di copertina",
        Español: "Carga, recorta y guarda la imagen de portada",
        Français: "Charger, découper et enregistrer l’image de couverture",
    },
    {
        English: "Preview cover",
        Italiano: "Anteprima immagine di copertina",
        Español: "Vista previa de la imagen de portada",
        Français: "Aperçu de l’image de couverture",
    },
    {
        English: "Title *",
        Italiano: "Titolo *",
        Español: "Tìtulo *",
        Français: "Titre *",
    },
    {
        English: "Body *",
        Italiano: "Testo *",
        Español: "Texto *",
        Français: "Texte *",
    },
    {
        English: "Who?",
        Italiano: "Chi?",
        Español: "¿Quién?",
        Français: "Qui ?",
    },
    {
        English: "Where?",
        Italiano: "Dove?",
        Español: "¿Donde?",
        Français: "Où?",
    },
    {
        English: "When?",
        Italiano: "Quando?",
        Español: "¿Cuando?",
        Français: "Quand?",
    },
    {
        English: "Hours",
        Italiano: "Orario",
        Español: "Hora",
        Français: "Heure",
    },
    {
        English: "Language",
        Italiano: "Lingua",
        Español: "Idioma",
        Français: "Langue",
    },
    {
        English: "Save",
        Italiano: "Salva",
        Español: "Guardar",
        Français: "Sauver",
    },
    {
        English: "Upload",
        Italiano: "Carica",
        Español: "Carga",
        Français: "Charge",
    },
    {
        English: "Download",
        Italiano: "Scarica",
        Español: "Descarga",
        Français: "Décharge",
    },
    {
        English: "Add",
        Italiano: "Aggiungi",
        Español: "Añade",
        Français: "Ajouter",
    },
    {
        English: "for template format see",
        Italiano: "per il formato dei temi guarda",
        Español: "para el formato de las plantillas  mira",
        Français: "pour le format des les modèle regarde",
    },
    {
        English: "Add bookmark",
        Italiano: "Aggiungi segnalibro",
        Español: "Añade marcador",
        Français: "Ajouter un signet",
    },
    {
        English: "Date",
        Italiano: "Data",
        Español: "Fecha",
        Français: "Date",
    },
    {
        English: "Pdf link",
        Italiano: "Link al Pdf",
        Español: "Enlace para el Pdf",
        Français: "Lien vers le PDF",
    },
    {
        English: "Close",
        Italiano: "Chiudi",
        Español: "Cierra",
        Français: "Fermer",
    },
    {
        English: "Delete item",
        Italiano: "Cancella oggetto",
        Español: "Borra el objeto",
        Français: "Effacer l’objet",
    },
    {
        English: "Are you sure you want to delete this item? You won't be able to recover it.",
        Italiano: "Sei sicuro di voler cancellare questo oggetto? Non sarai più in grado di recuperarlo.",
        Español: "¿Está seguro de que desea borrar este objeto? Ya no será capaz de recuperarlo.",
        Français: "Voulez -vous vraiment supprimer cet objet ? Vous ne pourrez plus le récupérer.",
    },
    {
        English: "Yes, delete it!",
        Italiano: "Sì, cancellalo!",
        Español: "¡Sí, borra el objeto!",
        Français: "Oui, efface ça !",
    },
    {
        English: "No",
        Italiano: "No",
        Español: "No",
        Français: "Non",
    },
    {
        English: "Are you sure you want to publish this item on Ipfs? You won't be able to edit it anymore.",
        Italiano: "Sei sicuro di voler pubblicare questo oggetto su Ipfs? Non potrai più modificarlo.",
        Español: "¿Está seguro de querer publicar este objeto en Ipfs? Ya no puede editarlo.",
        Français: "Voulez -vous vraiment publier cet objet sur Ipfs ? Vous ne pourrez plus le modifier.",
    },
    {
        English: "Yes, print it!",
        Italiano: "Sì, stampalo!",
        Español: "¡Sí, publícalo, por favor!",
        Français: "Oui, imprime le !",
    },
    {
        English: "Share this link",
        Italiano: "Condividi questo link",
        Español: "Compartir este enlace",
        Français: "Partager ce lien",
    },
    {
        English: "Copy Link",
        Italiano: "Copia Link",
        Español: "Copia este enlace",
        Français: "Copie ce lien",
    },
    {
        English: "Link copied on clipboard",
        Italiano: "Link copiato negli appunti",
        Español: "Enlace copiado al portapapeles",
        Français: "Lien copié vers le presse-papiers",
    },
    {
        English: "Please note",
        Italiano: "Attenzione",
        Español: "¡Atención!",
        Français: "Attention",
    },
    {
        English: "A flyer has not been saved. Do you want to delete it?",
        Italiano: "C'è un volantino che non è stato salvato. Vuoi cancellarlo?",
        Español: "Hay un volante que no fue guardado. ¿Quieres borrarlo?",
        Français: "Il y a un dépliant qui n’a pas été enregistré. Voulez -vous l’effacer?",
    },
    {
        English: "Yes, create a new flyer.",
        Italiano: "Sì, crea un nuovo volantino.",
        Español: "Sí, haz un nuevo volante.",
        Français: "Oui, crée un nouveau flyer.",
    },
    {
        English: "No, let me edit it.",
        Italiano: "No, vai alla modifica.",
        Español: "No, ve a la edición.",
        Français: "Non, va à l’édition.",
    },
    {
        English: "Cyclostyle uses localStorage for drafts and bookmarks. If you are in private mode, no data can be saved!",
        Italiano: "Cyclostyle usa localStorage per memorizzare bozze e segnalibri. Se navighi in modalità anonima, nessun dato verrà salvato!",
        Español: "Cyclostyle utiliza localStorage para almacenar borradores y marcadores. Si navega en modo anónimo, ¡no se guardará ningún dato!",
        Français: "Cyclostyle utilise localStorage pour stocker des brouillons et des signets. Si vous naviguez en mode anonyme, aucune donnée ne sera enregistrée!",
    },
    {
        English: "Got it, thanks!",
        Italiano: "Capito, grazie!",
        Español: "¡Lo entiendo, gracias!",
        Français: "J’ai compris, merci !",
    },
    {
        English: "Please provide a title.",
        Italiano: "Per favore inserisci un titolo.",
        Español: "Por favor, introduzca un título.",
        Français: "Veuillez saisir un titre.",
    },
    {
        English: "Please provide a body.",
        Italiano: "Per favore inserisci del testo.",
        Español: "Por favor, introduzca el texto.",
        Français: "Veuillez saisir du texte.",
    },
    {
        English: "Please provide a url.",
        Italiano: "Per favore inserisci un url.",
        Español: "Por favor, introduzca el enlace.",
        Français: "Veuillez saisir une url.",
    },
    {
        English: "There are no bookmarks saved yet.",
        Italiano: "Non ci sono ancora segnalibri salvati.",
        Español: "Aún no hay marcadores guardados.",
        Français: "Il n’y a pas encore de signets enregistrés.",
    },
    {
        English: "There are no drafts saved yet.",
        Italiano: "Non ci sono ancora bozze salvate.",
        Español: "Aún no hay borradores guardados.",
        Français: "Il n’y a pas encore de brouillons enregistrés.",
    },
    {
        English: "File size exceeds 1.5Mb",
        Italiano: "Il file pesa più di 1.5Mb",
        Español: "El tamaño del archivo supera 1.5Mb",
        Français: "La taille du fichier dépasse 1,5 Mo",
    },
];

// Global var :(


let selctedLang = getCookie("chosenLang");
if (selctedLang == "") {
    selctedLang = "English"
}

var mlrLangInUse;

var mlr = function({
    dropID = "mbPOCControlsLangDrop",
    stringAttribute = "data-mlr-text",
    chosenLang = selctedLang,
    mLstrings = MLstrings,
    countryCodes = false,
    countryCodeData = [],
} = {}) {
    const root = document.documentElement;

    var listOfLanguages = Object.keys(mLstrings[0]);
    mlrLangInUse = chosenLang;

    (function createMLDrop() {
        var mbPOCControlsLangDrop = document.getElementById(dropID);
        // Reset the menu
        mbPOCControlsLangDrop.innerHTML = "";
        // Now build the options
        listOfLanguages.forEach((lang, langidx) => {
            let HTMLoption = document.createElement("option");
            HTMLoption.value = lang;
            HTMLoption.textContent = lang;
            mbPOCControlsLangDrop.appendChild(HTMLoption);
            if (lang === chosenLang) {
                mbPOCControlsLangDrop.value = lang;
            }
        });
        resolveAllMLStrings();
        root.setAttribute("lang", updateCountryCodeOnHTML().code);

        mbPOCControlsLangDrop.addEventListener("change", function(e) {
            mlrLangInUse = mbPOCControlsLangDrop[mbPOCControlsLangDrop.selectedIndex].value;
            setCookie("chosenLang", mlrLangInUse, 365);
            resolveAllMLStrings();
            // Here we update the 2-digit lang attribute if required
            if (countryCodes === true) {
                if (!Array.isArray(countryCodeData) || !countryCodeData.length) {
                    console.warn("Cannot access strings for language codes");
                    return;
                }
                root.setAttribute("lang", updateCountryCodeOnHTML().code);
            }
        });

    })();

    function updateCountryCodeOnHTML() {
        return countryCodeData.find(this2Digit => this2Digit.name === mlrLangInUse);
    }

    function resolveAllMLStrings() {
        let stringsToBeResolved = document.querySelectorAll(`[${stringAttribute}]`);
        stringsToBeResolved.forEach(stringToBeResolved => {
            let originaltextContent = stringToBeResolved.textContent;
            let resolvedText = resolveMLString(originaltextContent, mLstrings);
            stringToBeResolved.textContent = resolvedText;
        });
    }
};

function resolveMLString(stringToBeResolved, mLstrings) {
    var matchingStringIndex = mLstrings.find(function(stringObj) {
        // Create an array of the objects values:
        let stringValues = Object.values(stringObj);
        // Now return if we can find that string anywhere in there
        return stringValues.includes(stringToBeResolved);
    });
    if (matchingStringIndex) {
        return matchingStringIndex[mlrLangInUse];
    } else {
        // If we don't have a match in our language strings, return the original
        return stringToBeResolved;
    }
}

mlr({
    dropID: "mbPOCControlsLangDrop",
    stringAttribute: "data-mlr-text",
    chosenLang: selctedLang,
    mLstrings: MLstrings,
    countryCodes: true,
    countryCodeData: mlCodes,
});



mlr({
    dropID: "mbPOCControlsLangDrop2",
    stringAttribute: "data-mlr-text",
    chosenLang: selctedLang,
    mLstrings: MLstrings,
    countryCodes: true,
    countryCodeData: mlCodes,
});

document.getElementById("mbPOCControlsLangDrop").addEventListener("change", function(e) {
    document.getElementById("mbPOCControlsLangDrop2").value = document.getElementById("mbPOCControlsLangDrop").value;
});

// link https://codepen.io/benfrain/pen/GdKrVx